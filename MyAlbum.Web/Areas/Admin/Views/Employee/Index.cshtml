@using MyAlbum.Models.Shared
@using System.Text.Json

@{
    ViewData["Title"] = "員工清單";
    var listUrl = Url.Action("GetEmployeeList", "Employee", new { area = "Admin" });
}
@{
    var perm = new
    {
        canRead = User.HasClaim("perm", "Employee.Read"),
        canUpdate = User.HasClaim("perm", "Employee.Write"),
        canDelete = User.HasClaim("perm", "Employee.Delete")
    };
}
<script>window.PERM = @Html.Raw(JsonSerializer.Serialize(perm));</script>
<script src="~/js/simple-grid.js"></script>

<div class="container py-3">
    <h3 class="mb-3">@ViewData["Title"]</h3>

    <!-- 可選的查詢表單（name 對應 EmployeeListReq 的屬性） -->
    <form id="empSearch" class="row g-2 mb-3">
        @Html.AntiForgeryToken()
        <div class="col-auto">
            <input type="text" class="form-control" name="FullName" placeholder="姓名（模糊查）">
        </div>

        <div class="col-auto">
            <button class="btn btn-primary" type="submit">查詢</button>
        </div>
    </form>

    @await Html.PartialAsync("_Grid", new GridOptions
    {
        ListUrl = listUrl,
        SearchFormId = "empSearch",
        TableId = "empTable",
        PagerId = "empPager",
        TotalId = "empTotal",
        PageSize = 10,
        Columns = new List<GridColumn> {
            new("fullName",   "姓名"),
            new("title",      "職稱"),
            new("hireDate",   "雇用日期", null, "date"),
            new("isActive",   "啟用", "90px", "bool"),
            new("employeeId", "操作", null, "actions")
        }
    })
</div>
<script>
    window.cellFormatters = Object.assign({}, window.cellFormatters, {
      actions: (id, row) => {
        const b=[];
        if (window.PERM?.canRead)   b.push(`<button class="btn btn-sm btn-outline-secondary me-1" onclick="viewEmp(${id})">檢視</button>`);
        if (window.PERM?.canUpdate) b.push(`<button class="btn btn-sm btn-primary me-1" onclick="editEmp(${id})">更新</button>`);
        if (window.PERM?.canDelete) b.push(`<button class="btn btn-sm btn-danger" onclick="delEmp(${id})">刪除</button>`);
        return b.join("");
      }
    });
</script>